<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>3D Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-button-color: #f4b324;
        }
        body {
            background-color: #f0f0f0;
            margin: 0; padding: 0;
            font-family: -apple-system, system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .item-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            position: relative;
        }
        .add-btn {
            background-color: var(--tg-theme-button-color);
            color: white;
            border-radius: 10px;
            padding: 8px;
            font-weight: 700;
            width: 100%;
            margin-top: 10px;
        }
        .remove-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #ff4d4d;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            display: none; /* –ü–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É */
        }
        .count-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f4b324;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            display: none;
        }
        .main-button-container {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            padding: 15px;
            background: #ffffff;
            border-top: 1px solid #e5e5e5;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body>

    <div class="m-4 p-4 bg-zinc-900 rounded-2xl shadow-lg text-white">
        <div class="flex items-center justify-between mb-2">
            <span class="text-[10px] font-bold uppercase opacity-50 tracking-widest">Global Search</span>
            <span class="text-yellow-500 text-[10px] font-bold uppercase">Thangs.com</span>
        </div>
        <div class="flex gap-2">
            <input id="q" type="text" placeholder="–ó–Ω–∞–π—Ç–∏ STL –º–æ–¥–µ–ª—å..." 
                class="flex-1 bg-zinc-800 border-none rounded-lg p-3 text-sm outline-none text-white placeholder:text-zinc-500">
            <button onclick="searchThangs()" class="bg-yellow-500 text-black px-4 rounded-lg font-black uppercase text-xs">GO</button>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-3 p-4 mb-32">
        <div class="item-card shadow-sm" id="card-dragon">
            <div id="badge-dragon" class="count-badge">0</div>
            <button id="remove-dragon" onclick="removeFromCart('Flexi Dragon', 400, 'dragon')" class="remove-btn">‚Äî</button>
            <div class="text-5xl mb-2">üêâ</div>
            <div class="text-sm font-bold">Flexi Dragon</div>
            <div class="text-yellow-500 font-bold">400 ‚Ç¥</div>
            <button onclick="addToCart('Flexi Dragon', 400, 'dragon')" class="add-btn uppercase text-xs">–î–æ–¥–∞—Ç–∏</button>
        </div>

        <div class="item-card shadow-sm" id="card-gear">
            <div id="badge-gear" class="count-badge">0</div>
            <button id="remove-gear" onclick="removeFromCart('Tech Gear', 150, 'gear')" class="remove-btn">‚Äî</button>
            <div class="text-5xl mb-2">‚öôÔ∏è</div>
            <div class="text-sm font-bold">Tech Gear</div>
            <div class="text-yellow-500 font-bold">150 ‚Ç¥</div>
            <button onclick="addToCart('Tech Gear', 150, 'gear')" class="add-btn uppercase text-xs">–î–æ–¥–∞—Ç–∏</button>
        </div>
    </div>

    <div id="footer-btn" class="main-button-container">
        <button onclick="sendToTelegram()" class="w-full bg-[#f4b324] text-white py-4 rounded-xl font-bold text-lg flex justify-center items-center gap-2 shadow-lg">
            –ü–ï–†–ï–ì–õ–Ø–ù–£–¢–ò –ó–ê–ú–û–í–õ–ï–ù–ù–Ø <span id="total-price" class="bg-black/20 px-3 py-1 rounded-lg">0 ‚Ç¥</span>
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let cart = {};
        let total = 0;

        function searchThangs() {
            const query = document.getElementById('q').value;
            if (query) {
                const url = `https://thangs.com/search/${encodeURIComponent(query)}`;
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥ Telegram –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –ø–æ—Å–∏–ª–∞–Ω—å
                tg.openLink(url);
            } else {
                tg.showAlert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∑–∞–ø–∏—Ç –¥–ª—è –ø–æ—à—É–∫—É");
            }
        }

        function addToCart(name, price, id) {
            if (!cart[id]) {
                cart[id] = { name: name, price: price, count: 0 };
            }
            cart[id].count++;
            total += price;
            updateUI(id);
            tg.HapticFeedback.impactOccurred('light');
        }

        function removeFromCart(name, price, id) {
            if (cart[id] && cart[id].count > 0) {
                cart[id].count--;
                total -= price;
                if (cart[id].count === 0) delete cart[id];
                updateUI(id);
                tg.HapticFeedback.notificationOccurred('warning');
            }
        }

        function updateUI(id) {
            const badge = document.getElementById('badge-' + id);
            const removeBtn = document.getElementById('remove-' + id);
            const count = cart[id] ? cart[id].count : 0;

            if (count > 0) {
                badge.style.display = 'block';
                badge.innerText = count;
                removeBtn.style.display = 'flex';
            } else {
                badge.style.display = 'none';
                removeBtn.style.display = 'none';
            }

            const footer = document.getElementById('footer-btn');
            if (total > 0) {
                footer.style.display = 'block';
                document.getElementById('total-price').innerText = total + ' ‚Ç¥';
            } else {
                footer.style.display = 'none';
            }
        }

        function sendToTelegram() {
            let orderText = "üõí –ú–û–Ñ –ó–ê–ú–û–í–õ–ï–ù–ù–Ø:%0A";
            for (let id in cart) {
                orderText += `- ${cart[id].name} x${cart[id].count} (${cart[id].price * cart[id].count} ‚Ç¥)%0A`;
            }
            orderText += `%0A–†–ê–ó–û–ú: ${total} ‚Ç¥`;

            // –ó–ê–ú–Ü–ù–ò '–¢–í–Ü–ô_–õ–û–ì–Ü–ù' –ù–ê –°–í–Ü–ô –ù–Ü–ö (–ë–ï–ó @)
            const MY_USER = "–¢–í–Ü–ô_–õ–û–ì–Ü–ù"; 
            tg.openTelegramLink(`https://t.me/${MY_USER}?text=${orderText}`);
        }
    </script>
</body>
</html>
