<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D UA HUB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --accent: #ffc107; --bg: #0d0d0d; --card-bg: #1a1a1a; }
        body { background-color: var(--bg); color: #f0f0f0; font-family: sans-serif; }
        .nav-pills .nav-link { color: #888; border-radius: 12px; border: 1px solid #333; margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: var(--accent); color: #000; font-weight: bold; }
        .card { background: var(--card-bg); border: 1px solid #333; border-radius: 15px; height: 100%; transition: 0.3s; }
        .card:hover { border-color: var(--accent); }
        .img-container { height: 150px; background: #222; border-radius: 15px 15px 0 0; overflow: hidden; position: relative; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .badge-tag { position: absolute; top: 10px; left: 10px; font-size: 10px; padding: 4px 8px; }
        .btn-stl { background: var(--accent); color: #000; font-weight: bold; border-radius: 10px; }
    </style>
</head>
<body>

<div class="container py-3">
    <h4 class="text-center mb-4 text-warning fw-bold">UA 3D –ê–ì–†–ï–ì–ê–¢–û–†</h4>

    <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="tab-ua" data-bs-toggle="pill" data-bs-target="#content-ua">üá∫üá¶ –ú–æ—ó –º–æ–¥–µ–ª—ñ</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="tab-trends" data-bs-toggle="pill" data-bs-target="#content-trends">üî• –°–≤—ñ—Ç–æ–≤—ñ —Ç—Ä–µ–Ω–¥–∏</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="content-ua">
            <div id="catalog-ua" class="row g-3">
                <div class="text-center py-5"><div class="spinner-border text-warning"></div></div>
            </div>
        </div>
        <div class="tab-pane fade" id="content-trends">
            <div id="catalog-trends" class="row g-3">
                <div class="text-center py-5 text-muted">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–≤—ñ—Ç–æ–≤—ñ —Ç—Ä–µ–Ω–¥–∏" –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. –í–°–¢–ê–í –°–í–Ü–ô ID –¢–ê–ë–õ–ò–¶–Ü
    const SHEET_ID = '–í–°–¢–ê–í_ID_–¢–ê–ë–õ–ò–¶–Ü_–¢–£–¢'; 
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    // 2. –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø UA –ë–ê–ó–ò
    async function loadUA() {
        const container = document.getElementById('catalog-ua');
        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            const data = json.table.rows.map(r => ({
                title: r.c[0]?.v || '3D –ú–æ–¥–µ–ª—å',
                link: r.c[3]?.v || '#',
                img: r.c[4]?.v || 'https://via.placeholder.com/300x200?text=No+Image',
                badge: 'UA'
            }));
            render(data, 'catalog-ua');
        } catch (e) {
            container.innerHTML = `<div class="text-center text-danger small">–ü–æ–º–∏–ª–∫–∞ Google –¢–∞–±–ª–∏—Ü—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é.</div>`;
        }
    }

    // 3. –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –¢–†–ï–ù–î–Ü–í (–ß–ï–†–ï–ó –°–¢–ê–ë–Ü–õ–¨–ù–ò–ô API –ü–ï–†–ï–ö–õ–ê–î–ê–ß)
    async function loadTrends() {
        const container = document.getElementById('catalog-trends');
        container.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-warning"></div><br><small>–ó'—î–¥–Ω—É—é—Å—å –∑—ñ —Å–≤—ñ—Ç–æ–≤–æ—é –±–∞–∑–æ—é...</small></div>';
        
        try {
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ RSS2JSON —è–∫ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π —à–ª—é–∑
            const rssUrl = encodeURIComponent('https://www.thingiverse.com/rss/popular');
            const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${rssUrl}`);
            const data = await res.json();
            
            if (data.status !== 'ok') throw new Error('RSS Error');

            let results = [];
            for (let item of data.items.slice(0, 12)) {
                // –í–∏—Ç—è–≥—É—î–º–æ –∫–∞—Ä—Ç–∏–Ω–∫—É
                const imgMatch = item.content.match(/src="([^"]+)"/);
                const img = imgMatch ? imgMatch[1] : item.thumbnail;
                
                // –ü–µ—Ä–µ–∫–ª–∞–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (—Å–ø—Ä–æ—â–µ–Ω–æ —á–µ—Ä–µ–∑ Google Translate API)
                const trRes = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=uk&dt=t&q=${encodeURIComponent(item.title)}`);
                const trData = await trRes.json();
                const ukTitle = trData[0][0][0];

                results.push({ title: ukTitle, link: item.link, img: img, badge: 'TREND' });
            }
            render(results, 'catalog-trends');
        } catch (e) {
            container.innerHTML = '<div class="text-center text-muted p-4">–°–µ—Ä–≤–µ—Ä —Ç—Ä–µ–Ω–¥—ñ–≤ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.</div>';
        }
    }

    function render(items, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = items.map(item => `
            <div class="col-6 col-md-4">
                <div class="card p-2 shadow-sm">
                    <div class="img-container mb-2">
                        <span class="badge ${item.badge === 'UA' ? 'bg-primary' : 'bg-danger'} badge-tag">${item.badge}</span>
                        <img src="${item.img}" onerror="this.src='https://via.placeholder.com/300x200?text=3D+Model'">
                    </div>
                    <div class="px-1">
                        <div class="text-truncate mb-2 fw-bold" style="font-size: 0.8rem;">${item.title}</div>
                        <a href="${item.link}" target="_blank" class="btn btn-stl btn-sm w-100">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
                    </div>
                </div>
            </div>
        `).join('');
    }

    loadUA();
    document.getElementById('tab-trends').addEventListener('click', loadTrends, {once: true});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
