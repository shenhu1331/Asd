<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UA 3D HUB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --accent: #ffc107; --bg: #0f0f0f; --card-bg: #1a1a1a; }
        body { background-color: var(--bg); color: #f0f0f0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .nav-pills .nav-link { color: #888; border-radius: 12px; font-weight: 600; border: 1px solid #333; margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: var(--accent); color: #000; border-color: var(--accent); }
        .card { background: var(--card-bg); border: 1px solid #333; border-radius: 15px; overflow: hidden; height: 100%; transition: transform 0.2s; }
        .card:active { transform: scale(0.96); }
        .img-container { position: relative; height: 160px; background: #222; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .badge-tag { position: absolute; top: 8px; left: 8px; font-size: 10px; font-weight: bold; padding: 3px 8px; border-radius: 6px; }
        .search-box { background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 12px; padding: 12px; margin-bottom: 20px; }
        .search-box:focus { background: #222; border-color: var(--accent); color: white; box-shadow: none; }
    </style>
</head>
<body>

<div class="container py-3">
    <input type="text" id="mainSearch" class="form-control search-box" placeholder="üîç –ù–∞–∑–≤–∞ –º–æ–¥–µ–ª—ñ...">

    <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="tab-ua" data-bs-toggle="pill" data-bs-target="#content-ua">üá∫üá¶ UA –ë–∞–∑–∞</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="tab-trends" data-bs-toggle="pill" data-bs-target="#content-trends">üî• –°–≤—ñ—Ç</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="content-ua">
            <div id="catalog-ua" class="row g-3">
                <div class="text-center py-5"><div class="spinner-border text-warning"></div></div>
            </div>
        </div>
        <div class="tab-pane fade" id="content-trends">
            <div id="catalog-trends" class="row g-3">
                <div class="text-center py-5 text-muted small">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–≤—ñ—Ç", —â–æ–± –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ —Ç—Ä–µ–Ω–¥–∏...</div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---
    const SHEET_ID = '–í–°–¢–ê–í_ID_–¢–ê–ë–õ–ò–¶–Ü_–°–Æ–î–ò'; // –¢–≤—ñ–π ID –∑ Google Sheets
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
    const TRENDS_RSS = 'https://www.thingiverse.com/rss/popular';

    // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–∫–ª–∞–¥—É
    async function translate(text) {
        try {
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=uk&dt=t&q=${encodeURIComponent(text)}`);
            const data = await res.json();
            return data[0][0][0];
        } catch { return text; }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Google –¢–∞–±–ª–∏—Ü—ñ
    async function loadUA() {
        const container = document.getElementById('catalog-ua');
        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            const items = json.table.rows.map(r => ({
                title: r.c[0]?.v || '–ë–µ–∑ –Ω–∞–∑–≤–∏',
                link: r.c[3]?.v || '#',
                img: r.c[4]?.v || 'https://via.placeholder.com/400x200',
                badge: 'UA'
            }));
            render(items, 'catalog-ua');
        } catch (e) {
            container.innerHTML = '<div class="text-center text-danger">–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ ID —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ —ó—ó –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é</div>';
        }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¢—Ä–µ–Ω–¥–æ–≤ (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ allorigins)
    async function loadTrends() {
        const container = document.getElementById('catalog-trends');
        container.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-warning"></div><br><small>–ü–∞—Ä—Å–∏–º–æ —Ç—Ä–µ–Ω–¥–∏...</small></div>';
        
        try {
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(TRENDS_RSS)}`;
            const res = await fetch(proxyUrl);
            const data = await res.json();
            
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data.contents, "text/xml");
            const items = xmlDoc.querySelectorAll("item");
            
            let trendModels = [];
            for (let i = 0; i < Math.min(items.length, 12); i++) {
                const title = items[i].querySelector("title").textContent;
                const link = items[i].querySelector("link").textContent;
                const desc = items[i].querySelector("description").textContent;
                const img = desc.match(/src="([^"]+)"/)?.[1] || 'https://via.placeholder.com/400x200';
                
                const ukTitle = await translate(title); // –ü–µ—Ä–µ–∫–ª–∞–¥–∞—î–º–æ –Ω–∞ –ª—å–æ—Ç—É
                trendModels.push({ title: ukTitle, link: link, img: img, badge: 'üî• HOT' });
            }
            render(trendModels, 'catalog-trends');
        } catch (e) {
            container.innerHTML = '<div class="text-center text-muted">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç—Ä–µ–Ω–¥–∏.</div>';
        }
    }

    // –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ–∫
    function render(items, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = items.map(item => `
            <div class="col-6 col-md-4 item-card" data-title="${item.title.toLowerCase()}">
                <div class="card">
                    <div class="img-container">
                        <span class="badge ${item.badge === 'UA' ? 'bg-primary' : 'bg-danger'} badge-tag">${item.badge}</span>
                        <img src="${item.img}" loading="lazy">
                    </div>
                    <div class="p-2 text-center">
                        <div class="text-truncate mb-2 fw-bold" style="font-size: 0.8rem;">${item.title}</div>
                        <a href="${item.link}" target="_blank" class="btn btn-sm btn-warning w-100 fw-bold">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</a>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // –ü–æ—à—É–∫
    document.getElementById('mainSearch').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        document.querySelectorAll('.item-card').forEach(c => {
            c.style.display = c.dataset.title.includes(q) ? 'block' : 'none';
        });
    });

    // –°—Ç–∞—Ä—Ç
    loadUA();
    document.getElementById('tab-trends').addEventListener('click', loadTrends, {once: true});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
