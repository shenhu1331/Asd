<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D UA HUB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --accent: #ffc107; --bg: #0b0b0b; --card-bg: #161616; }
        body { background-color: var(--bg); color: #e0e0e0; font-family: sans-serif; overflow-x: hidden; }
        .nav-pills .nav-link { color: #888; border-radius: 10px; border: 1px solid #222; margin: 0 4px; font-size: 0.9rem; }
        .nav-pills .nav-link.active { background-color: var(--accent); color: #000; font-weight: bold; }
        .card { background: var(--card-bg); border: 1px solid #222; border-radius: 12px; height: 100%; transition: 0.2s; }
        .img-container { height: 140px; position: relative; background: #222; border-radius: 12px 12px 0 0; overflow: hidden; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .badge-tag { position: absolute; top: 8px; left: 8px; font-size: 9px; text-transform: uppercase; }
        .search-box { background: #161616; border: 1px solid #333; color: white; border-radius: 10px; padding: 10px; margin-bottom: 15px; }
        .search-box:focus { background: #1a1a1a; border-color: var(--accent); color: white; box-shadow: none; }
        .btn-download { background: var(--accent); color: #000; font-weight: bold; font-size: 0.8rem; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container py-3">
    <input type="text" id="mainSearch" class="form-control search-box" placeholder="üîç –ü–æ—à—É–∫ –∑–∞ –Ω–∞–∑–≤–æ—é...">

    <ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="tab-ua" data-bs-toggle="pill" data-bs-target="#content-ua">üá∫üá¶ UA –ë–∞–∑–∞</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="tab-trends" data-bs-toggle="pill" data-bs-target="#content-trends">üåç –°–≤—ñ—Ç–æ–≤—ñ –¢—Ä–µ–Ω–¥–∏</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="content-ua">
            <div id="catalog-ua" class="row g-2">
                <div class="text-center py-5"><div class="spinner-border text-warning"></div></div>
            </div>
        </div>
        <div class="tab-pane fade" id="content-trends">
            <div id="catalog-trends" class="row g-2">
                <div class="text-center py-5 text-muted small">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–≤—ñ—Ç–æ–≤—ñ –¢—Ä–µ–Ω–¥–∏" –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è...</div>
            </div>
        </div>
    </div>
</div>

<script>
    // ‚ö†Ô∏è –ó–ê–ú–Ü–ù–ò –¶–ï–ô ID –ù–ê –°–í–Ü–ô
    const SHEET_ID = '–í–°–¢–ê–í_ID_–¢–ê–ë–õ–ò–¶–Ü_–¢–£–¢'; 
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    // –ü–µ—Ä–µ–∫–ª–∞–¥–∞—á
    async function translateText(text) {
        try {
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=uk&dt=t&q=${encodeURIComponent(text)}`);
            const data = await res.json();
            return data[0][0][0];
        } catch { return text; }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∞—à–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
    async function loadUA() {
        const container = document.getElementById('catalog-ua');
        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            const items = json.table.rows.map(r => ({
                title: r.c[0]?.v || '–ú–æ–¥–µ–ª—å',
                link: r.c[3]?.v || '#',
                img: r.c[4]?.v || 'https://via.placeholder.com/300x200',
                badge: 'UA'
            }));
            render(items, 'catalog-ua');
        } catch (e) {
            container.innerHTML = '<div class="text-center text-danger small p-4">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±–∞–∑–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é —Ç–∞–±–ª–∏—Ü—ñ.</div>';
        }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¢—Ä–µ–Ω–¥–æ–≤ (Thingiverse RSS —á–µ—Ä–µ–∑ AllOrigins Proxy)
    async function loadTrends() {
        const container = document.getElementById('catalog-trends');
        container.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-warning spinner-border-sm"></div><br><small>–®—É–∫–∞—é —Ç—Ä–µ–Ω–¥–∏...</small></div>';
        
        try {
            const proxy = 'https://api.allorigins.win/get?url=';
            const target = encodeURIComponent('https://www.thingiverse.com/rss/popular');
            const res = await fetch(proxy + target);
            const data = await res.json();
            
            const parser = new DOMParser();
            const xml = parser.parseFromString(data.contents, "text/xml");
            const items = xml.querySelectorAll("item");
            
            let results = [];
            for (let i = 0; i < Math.min(items.length, 12); i++) {
                const title = items[i].querySelector("title").textContent;
                const link = items[i].querySelector("link").textContent;
                const desc = items[i].querySelector("description").textContent;
                const img = desc.match(/src="([^"]+)"/)?.[1] || 'https://via.placeholder.com/300x200';
                
                const translatedTitle = await translateText(title);
                results.push({ title: translatedTitle, link: link, img: img, badge: 'TREND' });
            }
            render(results, 'catalog-trends');
        } catch (e) {
            container.innerHTML = '<div class="text-center text-muted small p-4">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç—Ä–µ–Ω–¥–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ —Ö–≤–∏–ª–∏–Ω—É.</div>';
        }
    }

    function render(items, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = items.map(item => `
            <div class="col-6 col-md-4 item-card" data-title="${item.title.toLowerCase()}">
                <div class="card p-2">
                    <div class="img-container mb-2">
                        <span class="badge ${item.badge === 'UA' ? 'bg-primary' : 'bg-danger'} badge-tag">${item.badge}</span>
                        <img src="${item.img}" loading="lazy">
                    </div>
                    <div class="text-truncate mb-2 px-1 fw-bold" style="font-size: 0.75rem;">${item.title}</div>
                    <a href="${item.link}" target="_blank" class="btn btn-download w-100 py-1">STL</a>
                </div>
            </div>
        `).join('');
    }

    document.getElementById('mainSearch').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        document.querySelectorAll('.item-card').forEach(c => {
            c.style.display = c.dataset.title.includes(q) ? 'block' : 'none';
        });
    });

    loadUA();
    document.getElementById('tab-trends').addEventListener('click', loadTrends, {once: true});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
