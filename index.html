<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D UA HUB | –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --tg-theme-bg: #0f0f0f; --accent: #ffc107; }
        body { background-color: var(--tg-theme-bg); color: #f0f0f0; font-family: 'Segoe UI', Roboto, sans-serif; }
        .nav-pills .nav-link { color: #888; border-radius: 12px; font-weight: 600; border: 1px solid #333; margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: var(--accent); color: #000; border-color: var(--accent); }
        .card { background: #1a1a1a; border: 1px solid #333; border-radius: 15px; overflow: hidden; height: 100%; transition: 0.2s; }
        .card:active { transform: scale(0.97); }
        .img-container { position: relative; height: 160px; background: #222; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .badge-type { position: absolute; top: 10px; left: 10px; font-size: 10px; padding: 4px 8px; border-radius: 8px; }
        .search-box { background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 12px; padding: 12px; }
        .search-box:focus { background: #222; border-color: var(--accent); color: white; box-shadow: none; }
    </style>
</head>
<body>

<div class="container py-3">
    <div class="mb-4">
        <input type="text" id="mainSearch" class="form-control search-box" placeholder="üîç –ü–æ—à—É–∫ –º–æ–¥–µ–ª–µ–π...">
    </div>

    <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item shadow-sm">
            <button class="nav-link active" id="tab-ua" data-bs-toggle="pill" data-bs-target="#content-ua">üá∫üá¶ UA –ë–∞–∑–∞</button>
        </li>
        <li class="nav-item shadow-sm">
            <button class="nav-link" id="tab-trends" data-bs-toggle="pill" data-bs-target="#content-trends">üî• –¢—Ä–µ–Ω–¥–∏</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="content-ua">
            <div id="catalog-ua" class="row g-3">
                <div class="text-center py-5"><div class="spinner-border text-warning"></div></div>
            </div>
        </div>
        <div class="tab-pane fade" id="content-trends">
            <div id="catalog-trends" class="row g-3">
                <div class="text-center py-5 text-muted">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–¢—Ä–µ–Ω–¥–∏" –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
        </div>
    </div>
</div>

<script>
    // –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø
    const SHEET_ID = '–í–ê–®_ID_–¢–ê–ë–õ–ò–¶–Ü'; // <--- –í–°–¢–ê–í–¢–ï –°–í–Ü–ô ID
    const GOOGLE_SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
    const THINGIVERSE_RSS = 'https://www.thingiverse.com/rss/popular';

    // –§–£–ù–ö–¶–Ü–Ø –ü–ï–†–ï–ö–õ–ê–î–£ (—á–µ—Ä–µ–∑ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ø—Ä–æ–∫—Å—ñ)
    async function translateText(text) {
        try {
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=uk&dt=t&q=${encodeURIComponent(text)}`);
            const data = await res.json();
            return data[0][0][0];
        } catch { return text; }
    }

    // –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –í–ê–®–û–á –ë–ê–ó–ò
    async function loadUA() {
        try {
            const res = await fetch(GOOGLE_SHEET_URL);
            const text = await res.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            render(json.table.rows.map(r => ({
                title: r.c[0].v, desc: r.c[1].v, cat: r.c[2].v, link: r.c[3].v, img: r.c[4].v, badge: 'UA'
            })), 'catalog-ua');
        } catch (e) { console.error(e); }
    }

    // –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –¢–†–ï–ù–î–Ü–í –ó –ü–ï–†–ï–ö–õ–ê–î–û–ú
    async function loadTrends() {
        const container = document.getElementById('catalog-trends');
        container.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary"></div><br>–ü–µ—Ä–µ–∫–ª–∞–¥–∞—é —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é...</div>';
        
        try {
            const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(THINGIVERSE_RSS)}`);
            const data = await res.json();
            
            const models = await Promise.all(data.items.slice(0, 10).map(async item => {
                const ukTitle = await translateText(item.title);
                let img = item.content.match(/src="([^"]+)"/)?.[1] || 'https://via.placeholder.com/400x200';
                return { title: ukTitle, desc: '–ü–æ–ø—É–ª—è—Ä–Ω–∞ –º–æ–¥–µ–ª—å –∑—ñ —Å–≤—ñ—Ç—É', cat: 'Thingiverse', link: item.link, img: img, badge: 'üî•' };
            }));
            
            render(models, 'catalog-trends');
        } catch (e) { container.innerHTML = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç—Ä–µ–Ω–¥—ñ–≤."; }
    }

    function render(items, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = items.map(item => `
            <div class="col-6 col-md-4 model-card" data-title="${item.title.toLowerCase()}">
                <div class="card shadow-sm">
                    <div class="img-container">
                        <span class="badge bg-dark badge-type">${item.badge}</span>
                        <img src="${item.img}" loading="lazy">
                    </div>
                    <div class="p-2">
                        <h6 class="text-truncate mb-1" style="font-size: 0.85rem;">${item.title}</h6>
                        <a href="${item.link}" target="_blank" class="btn btn-sm btn-warning w-100 py-1">–û—Ç—Ä–∏–º–∞—Ç–∏</a>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // –ü–û–®–£–ö
    document.getElementById('mainSearch').addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        document.querySelectorAll('.model-card').forEach(card => {
            card.style.display = card.dataset.title.includes(query) ? 'block' : 'none';
        });
    });

    // –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
    loadUA();
    document.getElementById('tab-trends').addEventListener('click', loadTrends, {once: true});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
