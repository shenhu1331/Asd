<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D UA HUB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root { --accent: #ffc107; --bg: #0d0d0d; --card-bg: #1a1a1a; }
        body { background-color: var(--bg); color: #f0f0f0; font-family: 'Segoe UI', sans-serif; }
        .nav-pills .nav-link { color: #888; border-radius: 12px; border: 1px solid #333; margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: var(--accent); color: #000; font-weight: bold; }
        .card { background: var(--card-bg); border: 1px solid #333; border-radius: 15px; height: 100%; transition: 0.3s; }
        .img-container { height: 150px; background: #222; border-radius: 15px 15px 0 0; overflow: hidden; position: relative; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .badge-tag { position: absolute; top: 10px; left: 10px; font-size: 10px; padding: 4px 8px; }
        .btn-stl { background: var(--accent); color: #000; font-weight: bold; border-radius: 10px; }
        .search-box { background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 12px; padding: 12px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container py-3">
    <h4 class="text-center mb-4 text-warning fw-bold">3D UA HUB üì¶</h4>

    <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="tab-ua" data-bs-toggle="pill" data-bs-target="#content-ua">üá∫üá¶ UA –ë–∞–∑–∞</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="tab-trends" data-bs-toggle="pill" data-bs-target="#content-trends">üåç –°–≤—ñ—Ç–æ–≤–∏–π –ü–æ—à—É–∫</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="content-ua">
            <input type="text" id="uaSearch" class="form-control search-box" placeholder="–ü–æ—à—É–∫ –≤ –º–æ—ó–π –±–∞–∑—ñ...">
            <div id="catalog-ua" class="row g-3">
                <div class="text-center py-5"><div class="spinner-border text-warning"></div></div>
            </div>
        </div>

        <div class="tab-pane fade text-center" id="content-trends">
            <div class="py-4">
                <h5>–©–æ –∑–Ω–∞–π—Ç–∏ —É —Å–≤—ñ—Ç—ñ?</h5>
                <p class="small text-muted text-center">–í–≤–µ–¥—ñ—Ç—å –∑–∞–ø–∏—Ç —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é, –º–∏ –∑–Ω–∞–π–¥–µ–º–æ –Ω–∞ Thingiverse —Ç–∞ Printables</p>
                <div class="input-group mb-3 px-3">
                    <input type="text" id="worldSearchInput" class="form-control search-box mb-0" placeholder="–ù–∞–ø—Ä: –ö—ñ—Ç, –®–µ—Å—Ç–µ—Ä–Ω—è, –ö—Ä–æ–Ω—à—Ç–µ–π–Ω">
                    <button class="btn btn-warning" type="button" id="btnWorldSearch"><i class="bi bi-search"></i></button>
                </div>
                <div id="world-results" class="row g-3 mt-2 text-start">
                    <div class="col-12 p-4 text-muted small">–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º–æ–¥–µ–ª—ñ –≤–∏—â–µ ‚òùÔ∏è</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. –ó–ê–ú–Ü–ù–ò –¶–ï–ô ID –ù–ê –°–í–Ü–ô
    const SHEET_ID = '–í–°–¢–ê–í_ID_–¢–ê–ë–õ–ò–¶–Ü_–¢–£–¢'; 
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    // –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è UA –ë–∞–∑–∏
    async function loadUA() {
        const container = document.getElementById('catalog-ua');
        try {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            const data = json.table.rows.map(r => ({
                title: r.c[0]?.v || '–ú–æ–¥–µ–ª—å',
                link: r.c[3]?.v || '#',
                img: r.c[4]?.v || 'https://via.placeholder.com/300x200?text=3D+Model',
                badge: 'UA'
            }));
            window.uaData = data; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–ª—è –ø–æ—à—É–∫—É
            render(data, 'catalog-ua');
        } catch (e) {
            container.innerHTML = `<div class="text-center text-danger">–ü–æ–º–∏–ª–∫–∞ —Ç–∞–±–ª–∏—Ü—ñ. –ü–µ—Ä–µ–≤—ñ—Ä –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é.</div>`;
        }
    }

    // –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ–∫
    function render(items, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = items.map(item => `
            <div class="col-6 col-md-4 mb-2">
                <div class="card p-2 shadow-sm">
                    <div class="img-container mb-2">
                        <span class="badge bg-primary badge-tag">${item.badge}</span>
                        <img src="${item.img}" onerror="this.src='https://via.placeholder.com/300x200?text=3D+Model'">
                    </div>
                    <div class="text-truncate mb-2 fw-bold" style="font-size: 0.75rem; color: #fff;">${item.title}</div>
                    <a href="${item.link}" target="_blank" class="btn btn-stl btn-sm w-100">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
                </div>
            </div>
        `).join('');
    }

    // –°–í–Ü–¢–û–í–ò–ô –ü–û–®–£–ö (–õ–æ–≥—ñ–∫–∞ Yeggi)
    document.getElementById('btnWorldSearch').addEventListener('click', async () => {
        const input = document.getElementById('worldSearchInput').value;
        if(!input) return;

        const container = document.getElementById('world-results');
        container.innerHTML = '<div class="text-center py-5 w-100"><div class="spinner-border text-warning"></div><br>–ü–µ—Ä–µ–∫–ª–∞–¥–∞—é —Ç–∞ —à—É–∫–∞—é...</div>';

        // 1. –ê–≤—Ç–æ-–ø–µ—Ä–µ–∫–ª–∞–¥ –Ω–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫—É
        const trRes = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=uk&tl=en&dt=t&q=${encodeURIComponent(input)}`);
        const trData = await trRes.json();
        const enQuery = trData[0][0][0];

        // 2. –§–æ—Ä–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∏
        const thingiLink = `https://www.thingiverse.com/search?q=${enQuery.replace(' ', '+')}`;
        const printLink = `https://www.printables.com/search/models?q=${enQuery.replace(' ', '+')}`;
        const yeggiLink = `https://www.yeggi.com/q/${enQuery.replace(' ', '+')}/`;

        container.innerHTML = `
            <div class="col-12 mt-3">
                <p class="small">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è: <b>${enQuery}</b></p>
                <div class="list-group">
                    <a href="${thingiLink}" target="_blank" class="list-group-item list-group-item-action bg-dark text-white border-secondary mb-2 rounded shadow-sm">
                        <i class="bi bi-box-seam text-warning me-2"></i> –ó–Ω–∞–π—Ç–∏ –Ω–∞ <b>Thingiverse</b>
                    </a>
                    <a href="${printLink}" target="_blank" class="list-group-item list-group-item-action bg-dark text-white border-secondary mb-2 rounded shadow-sm">
                        <i class="bi bi-layers text-warning me-2"></i> –ó–Ω–∞–π—Ç–∏ –Ω–∞ <b>Printables</b>
                    </a>
                    <a href="${yeggiLink}" target="_blank" class="list-group-item list-group-item-action bg-dark text-white border-secondary mb-2 rounded shadow-sm">
                        <i class="bi bi-search text-warning me-2"></i> –í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ <b>Yeggi –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä—ñ</b>
                    </a>
                </div>
                <p class="text-muted x-small mt-3 text-center" style="font-size: 11px;">–ú–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∫–ª–∞–ª–∏ –≤–∞—à –∑–∞–ø–∏—Ç –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –ø–æ—à—É–∫—É</p>
            </div>
        `;
    });

    // –ü–æ—à—É–∫ –ø–æ UA –±–∞–∑—ñ
    document.getElementById('uaSearch').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        const filtered = window.uaData.filter(item => item.title.toLowerCase().includes(q));
        render(filtered, 'catalog-ua');
    });

    loadUA();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
